

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8.3. Time Distribution System &mdash; GMT Software And Controls documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/additional_style.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="GMT Software And Controls documentation" href="../../index.html"/>
        <link rel="up" title="8. Platform" href="platform.html"/>
        <link rel="next" title="8.4. Distributed Communications - Middleware" href="distributed_communications.html"/>
        <link rel="prev" title="8.2. Field Device Interface Technology" href="field_device_interface_technology.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GMT Software And Controls
          

          
            
            <img src="../../_static/logowhite.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../release_notes/index.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Architecture and Design</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction/swcs_introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../requirements/requirements.html">2. Requirements Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../architecture/overall_architecture.html">3. Overall Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operations/observatory_operations.html">4. Observatory Operation System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tcs/tcs_introduction.html">5. Telescope Control System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services/observatory_services.html">6. Observatory Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/component_frameworks.html">7. Frameworks</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="platform.html">8. Platform</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="computing.html">8.1. Computing Platform</a></li>
<li class="toctree-l3"><a class="reference internal" href="field_device_interface_technology.html">8.2. Field Device Interface Technology</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">8.3. Time Distribution System</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#time-distribution-protocols">8.3.1. <em>Time Distribution Protocols</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#precision-time-protocol">8.3.2. <em>Precision Time Protocol</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#ptp-software-stacks-for-linux">8.3.3. <em>PTP Software Stacks for Linux</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#lab-evaluation">8.3.4. <em>Lab Evaluation</em></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="distributed_communications.html">8.4. Distributed Communications - Middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="networking.html">8.5. Networking</a></li>
<li class="toctree-l3"><a class="reference internal" href="software_development.html">8.6. Software Development Platform</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/process_introduction.html">9. Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../risks/risks.html">10. Software and Control Risks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bibliography/bibliography.html">11. Bibliography</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../SWC_standards/index.html">Software and Controls Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software_development/index.html">Software Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_products/index.html">Data Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/swc_sys_glossary.html">Software and Controls Acronyms and Definitions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GMT Software And Controls</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Architecture and Design</a> &raquo;</li>
        
          <li><a href="platform.html">8. Platform</a> &raquo;</li>
        
      <li>8.3. Time Distribution System</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="time-distribution-system">
<span id="id1"></span><h1>8.3. Time Distribution System<a class="headerlink" href="#time-distribution-system" title="Permalink to this headline">¶</a></h1>
<p>While individual subsystems often provide their own internal clock(s), quality
and accuracy of (crystals) varies vastly between systems. A time distribution
system allows a heterogeneous set of controllers to reference and to synchronize
to the same master clock, and to share the same notional measure of time within
a distributed framework. Time systems are commonly layered into strata,
referring to how far each clock is located from the reference clock. For
telescope applications, a GPS clock (stratum 1) heads the hierarchy and acts as
the grand master clock.</p>
<p>A time system is particularly relevant for the GMT Telescope where time
synchronization plays an important role in many areas. In calculating a
telescope slew trajectory, for example, the telescope kernel pointing
coordinates must be computed using the GPS time; or for calculating continuous
drive demands, where it is necessary to interpolate between time stamps; or for
telemetry case, where uniform timestamps must be used to correlate real-time and
archive data.</p>
<table border="1" class="docutils" id="id3">
<caption><span class="caption-number">Table 8.4 </span><span class="caption-text">SWCS Time Distribution Requirements (Level 3)</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><div class="first last line-block">
<div class="line">Requirement</div>
</div>
</th>
<th class="head"><div class="first last line-block">
<div class="line">Statement</div>
</div>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">Synchronization</div>
<div class="line">Time Budget</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Provide the capability to coordinate the operations of</div>
<div class="line">subsystems during operations to within time budgets</div>
<div class="line">allotted by the SLR.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">Time Reference</div>
<div class="line"><br /></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Provide the capability to obtain and distribute a time</div>
<div class="line">reference accurate to 1ms (TBR).</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="section" id="time-distribution-protocols">
<h2>8.3.1. <em>Time Distribution Protocols</em><a class="headerlink" href="#time-distribution-protocols" title="Permalink to this headline">¶</a></h2>
<p>The most popular time distribution protocols are the Network Time Protocol
(NTP), the Inter-range Instrumentation Group code B (IRIG-B) and the Precision
Time Protocol (PTP). Their main characteristics are described in the following
list:</p>
<blockquote>
<div><ul class="simple">
<li>NTP is the de-facto standard for computer clusters. NTP assets include:
platform independence, availability on all operating systems, and simple
deployment relying on ubiquitous Ethernet connection. NTP precision is
limited by unaccounted network transmission delays, and susceptibility to
changes in the network topology.</li>
<li>IRIG-B is commonly used by 8-10m class telescopes and other major
experimental physics control systems. More accurate synchronization is
achieved in this case using a dedicated hardware clock and connection.
IRIG-B effectively builds a time bus concept that features specialized
components (hardware, software drivers, etc.) making it somewhat cumbersome
and often time-consuming to implement, adding extra burden to the deployment
(dedicated networks of coaxial cables are needed) and increasing the
implementation cost (specialized hardware for all sub-systems is required).</li>
<li>PTP emerged more recently in the distributed cluster world. It addresses
deficiencies of NTP, offering more accurate timestamps (thanks to
synchronization packets) and accounting for transmission delays in the
network. The second revision of the protocol achieves further accuracy by
using specialized network interface cards (NICs) and transparent clocks. The
NICs can provide hardware timestamp, so the nearer to the hardware the
timestamps are generated the higher the precision.</li>
</ul>
</div></blockquote>
<p>The main features of the relevant time protocols are summarized in the Table
below:</p>
<table border="1" class="docutils" id="id4">
<caption><span class="caption-number">Table 8.5 </span><span class="caption-text">Time Protocols Comparison</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="10%" />
<col width="19%" />
<col width="14%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Protocol</th>
<th class="head">Sync. Accuracy</th>
<th class="head">Interconnect</th>
<th class="head">Properties</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>NTP</td>
<td>~ 2 ms</td>
<td>LAN/WAN</td>
<td>Subject to network delays, affected by topology changes</td>
</tr>
<tr class="row-odd"><td>Protocol</td>
<td>Sync. Accuracy</td>
<td>Interconnect</td>
<td>Properties</td>
</tr>
<tr class="row-even"><td>IRIG-B</td>
<td>1-10 us</td>
<td>Coaxial</td>
<td>Needs dedicated hardware and software drivers</td>
</tr>
<tr class="row-odd"><td rowspan="2">PTP</td>
<td>5-50 us (software)</td>
<td>LAN</td>
<td>Measure and compensate transmission delays</td>
</tr>
<tr class="row-even"><td>&lt; 1 us (hardware)</td>
<td>&#160;</td>
<td>Better accuracy using dedicated NICs and switches</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="precision-time-protocol">
<h2>8.3.2. <em>Precision Time Protocol</em><a class="headerlink" href="#precision-time-protocol" title="Permalink to this headline">¶</a></h2>
<p>A growing number of industrial and power utility tasks require the use of
time-synchronized networks. Traditionally, timing information was distributed
via a dedicated network separate from the main application, such as real-time
distribution protocols, of which IRIG-B is perhaps the best known. More
recently, the market has shifted to a single converged data and distributed
timing network based on standard Ethernet running IEEE1588 Precision Time
Protocol as part of the application layer. The protocol can achieve
sub-microsecond synchronization performance over distributed networks. The
IEEE15888 Standard is currently in its 2nd revision.</p>
</div>
<div class="section" id="ptp-software-stacks-for-linux">
<h2>8.3.3. <em>PTP Software Stacks for Linux</em><a class="headerlink" href="#ptp-software-stacks-for-linux" title="Permalink to this headline">¶</a></h2>
<p>Several open source (e.g., ptpd-2, ptppd-phc) and commercial (e.g., IXXAT,
FSMLabs) software stacks are available for Linux, including network drivers
with hardware timestamp (e.g., Blackfin on-chip Ethernet MAC driver, Intel
Gigabit Ethernet Network Driver). Refer to the report IEEE- 1588 PTP
Evaluation <a class="reference internal" href="../bibliography/bibliography.html#bec12d" id="id2">[Bec12d]</a> for a detailed list and analysis on the software stacks for
Linux.</p>
</div>
<div class="section" id="lab-evaluation">
<h2>8.3.4. <em>Lab Evaluation</em><a class="headerlink" href="#lab-evaluation" title="Permalink to this headline">¶</a></h2>
<p>Several PTP topologies to measure synchronization accuracy have been tested at
the GMT lab67. A common arrangement is shown in Figure below:</p>
<div class="figure" id="id5">
<img alt="../../_images/PTP-master-slaves.png" src="../../_images/PTP-master-slaves.png" />
<p class="caption"><span class="caption-number">Fig. 8.7 </span><span class="caption-text">PTP Master with 2 Slaves Arrangement using a Switched Network and a Dedicated
NIC.</span></p>
</div>
<p>Two slave computers were synchronized with PTP and each was generating a
digital pulse over the serial communications port at 10 Hz. The test was
carried out over a private LAN using one dedicated NIC isolated from the
intranet and another NIC that was running the EtherCAT master in the
background. The daemon used for the test was the ptpd-2 open source stack.</p>
<p>Synchronization accuracy was measured with an oscilloscope, capturing the
delay and variation between the two independently generated pulses as shown in
the Figure below. Over one million samples – which at 10 pulses per second
translates roughly into 27 hours – the standard deviation is less than 2.5us
and representative of PTP stability. The min/max outliers amplitude at &lt; 25us
falls within the technology accepted published figures.</p>
<div class="figure" id="id6">
<img alt="../../_images/PTP-synchronization-accuracy.png" src="../../_images/PTP-synchronization-accuracy.png" />
<p class="caption"><span class="caption-number">Fig. 8.8 </span><span class="caption-text">Lab PTP Synchronization Accuracy Tests</span></p>
</div>
<p>During the tests a couple of disturbances were introduced to evaluate the
synchronization robustness. First some network traffic was initiated,
essentially copying the entire file system from the master machine to an
external computer outside the PTP LAN (directing the traffic to the general
LAN). The accuracy in this case did not seem to be affected. Next, the
machine was artificially loaded at lower priority, leaving the non-isolated
CPU with 100% effective load. No evident effect on timing accuracy was
observed.</p>
<p>A summary with all the measured quantities using a ptpd-2 implementation of
the Linux PTP Software Stack is presented in the following Table:</p>
<table border="1" class="docutils" id="id7">
<caption><span class="caption-number">Table 8.6 </span><span class="caption-text">ptpd-2 Implementation Measured Accuracy</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="59%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Statistic</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Samples (pulses)</td>
<td>&gt; 1 million</td>
</tr>
<tr class="row-odd"><td>Mean offset</td>
<td>1.70 us</td>
</tr>
<tr class="row-even"><td>Standard deviation</td>
<td>2.48 us</td>
</tr>
<tr class="row-odd"><td>Min/Max amplitude</td>
<td>24 us</td>
</tr>
</tbody>
</table>
<p>The PTP network tested before was reconfigured to work over the common LAN,
using now the same NIC for PTP synchronization and general networking. The
table below shows the statistics obtained over the common LAN case, and as
expected, the performance is slightly worse (about 60%) than using a dedicated
LAN.</p>
<table border="1" class="docutils" id="id8">
<caption><span class="caption-number">Table 8.7 </span><span class="caption-text">ptpd-2 Measured Accuracy over a Common LAN</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="59%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Statistic</th>
<th class="head">Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Samples (pulses)</td>
<td>278 k</td>
</tr>
<tr class="row-odd"><td>Mean offset</td>
<td>5.60 us</td>
</tr>
<tr class="row-even"><td>Standard deviation</td>
<td>4.21 us</td>
</tr>
<tr class="row-odd"><td>Min/Max amplitude</td>
<td>35.4 us</td>
</tr>
</tbody>
</table>
<p>For optimal performance with EtherCAT, a patched driver for the fieldbus
enabled NIC was used. During the tests, some interactions between the PTP
daemon and the driver were observed, right when the EtherCAT master was
started and the patched driver for the NIC got loaded. The issue can be
addressed by sequencing the access to the NIC, for example by stopping the PTP
daemon while EtherCAT initializes and then running it again after EtherCAT has
started.</p>
<p>In summary, PTP has several advantages for time distribution and
synchronization in a widely distributed system as GMT:</p>
<blockquote>
<div><ul class="simple">
<li>Easy and inexpensive to implement using a LAN infrastructure</li>
<li>Common and proven technology</li>
<li>Guaranteed long time support</li>
</ul>
</div></blockquote>
<p>However, a pure software solution may not be enough for a system requiring
very high timing resolution stability. The numbers collected during these
tests are consistent with the literature and leave no reason to doubt hardware
solutions could bring sub-microsecond accuracy. For the GMT Telescope Control,
a more detailed system analysis should be carried out if 5-50 microsecond
accuracy is necessary.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="distributed_communications.html" class="btn btn-neutral float-right" title="8.4. Distributed Communications - Middleware" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="field_device_interface_technology.html" class="btn btn-neutral" title="8.2. Field Device Interface Technology" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, contributors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.2-6',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>